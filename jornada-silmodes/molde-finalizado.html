<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="IMG/icon.png" class="icon" alt="icon">
    <title>Detalhes do Molde MP-001 | Simoldes Tools</title>
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="CSS/style-DM.css">
</head>
<body>
    <header>
        <a href="index.html">
            <img src="IMG/logo.png" alt="Logo Simoldes" class="logo">
        </a>
        <nav>
            <!-- Menu de navega√ß√£o similar ao index.html -->
        </nav>
    </header>

    <main class="detail-container">
        <div class="breadcrumb">
            <a href="index.html">Home</a> > 
            <a href="index.html">Moldes em Produ√ß√£o</a>
            <span>1678</span>
        </div>

        <div class="molde-header">
            <h1>Molde 1678</h1>
            <div class="status-badge em-producao">Em Produ√ß√£o</div>
        </div>

        <div class="detail-grid">
            <!-- Se√ß√£o 1: Informa√ß√µes B√°sicas -->
            <section class="card basic-info">
                <h2>Informa√ß√µes B√°sicas</h2>
                <div class="editable-field">
                    <label>Cliente:</label>
                    <span class="value">Ind√∫stria ABC</span>
                    <button class="edit-btn">Editar</button>
                </div>
                <div class="editable-field">
                    <label>Data In√≠cio:</label>
                    <span class="value">15/03/2023</span>
                    <button class="edit-btn">Editar</button>
                </div>
                <div class="editable-field">
                    <label>Previs√£o Entrega:</label>
                    <span class="value">30/04/2023</span>
                    <button class="edit-btn">Editar</button>
                </div>
                <div class="editable-field">
                    <label>Respons√°vel:</label>
                    <span class="value">Eng. Carlos Silva</span>
                    <button class="edit-btn">Editar</button>
                </div>
            </section>

            <!-- Se√ß√£o 3: Etapas de Produ√ß√£o -->
            <section class="card etapas">
                <h2>Etapas de Produ√ß√£o</h2>
                <div class="timeline">
                    <div class="etapa completed">
                        <div class="etapa-header">
                            <span class="etapa-nome">Projeto 3D</span>
                            <span class="etapa-status">Conclu√≠do</span>
                        </div>
                        <div class="etapa-info">
                            <span>Respons√°vel: Equipe CAD</span>
                            <span>Conclus√£o: 10/03/2023</span>
                            <button class="view-file-btn">Ver Arquivo</button>
                        </div>
                    </div>
                    <div class="etapa in-progress">
                        <div class="etapa-header">
                            <span class="etapa-nome">Usinagem</span>
                            <span class="etapa-status">Em Andamento</span>
                        </div>
                        <div class="etapa-info">
                            <span>Respons√°vel: M√°quina CNC-5</span>
                            <span>Previs√£o: 25/03/2023</span>
                            <button class="update-btn">Atualizar</button>
                        </div>
                    </div>
                    <div class="etapa pending">
                        <div class="etapa-header">
                            <span class="etapa-nome">Montagem</span>
                            <span class="etapa-status">Pendente</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 2: Controle de Pe√ßas do Molde -->
            <section class="card pecas-molde full-width">
                <h2>Controle de Pe√ßas do Molde</h2>
                <div class="table-controls">
                    <div class="import-buttons">
                        <button class="add-peca-btn" id="add-peca-btn">
                            <span>+</span> Adicionar Pe√ßa
                        </button>
                        <button class="import-excel-btn" id="import-excel-btn">
                            <span>üìä</span> Importar do Excel
                        </button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="peca-search" placeholder="Buscar pe√ßa...">
                        <button id="search-peca-btn">üîç</button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="pecas-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                                <th>Modelo 3D</th>
                                <th>CHEGADA DO A√áO</th>
                                <th>PROGRAMA NC</th>
                                <th>DMG</th>
                                <th>600 II</th>
                                <th>800 II</th>
                                <th>600 I</th>
                                <th>800 I</th>
                                <th>IXION II</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="pecas-list">
                            <tr>
                                <td>1</td>
                                <td>Placa Base</td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td>
                                    <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                                    <button class="action-btn" title="Remover">üóëÔ∏è</button>
                                </td>
                            </tr>
                            <tr>
                                <td>100</td>
                                <td>N√∫cleo Principal</td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td>
                                    <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                                    <button class="action-btn" title="Remover">üóëÔ∏è</button>
                                </td>
                            </tr>
                            <tr>
                                <td>200</td>
                                <td>Cavidade Superior</td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox" checked></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td><input type="checkbox"></td>
                                <td>
                                    <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                                    <button class="action-btn" title="Remover">üóëÔ∏è</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Bot√£o de Salvar -->
        <div class="save-container">
            <button class="save-all-btn" id="save-all-data">
                <span class="save-icon">üíæ</span> Salvar Todas as Altera√ß√µes
            </button>
        </div>
        
    </main>

    <footer>
        <p>&copy; 2025 Simoldes Tools. Todos os direitos reservados.</p>
    </footer>

    <script>
        // Fun√ß√£o principal que ser√° executada quando o DOM estiver pronto
        function initPage() {
            // Captura o ID da URL
            const urlParams = new URLSearchParams(window.location.search);
            const moldeId = urlParams.get('id') || "1678"; // Default para exemplo
            
            // Carrega os dados do molde
            const moldeData = carregarDadosMolde(moldeId);
            preencherDados(moldeData);
            
            setupEventListeners();
        }

        // Fun√ß√£o para carregar dados (simulada)
        function carregarDadosMolde(id) {
            // Dados simulados - substitua por chamada real √† API
            return {
                id: id,
                cliente: "Ind√∫stria ABC",
                dataInicio: "15/03/2023",
                previsaoEntrega: "30/04/2023",
                responsavel: "Eng. Carlos Silva",
                pecas: [
                    { item: "1", descricao: "Placa Base", status: "100", etapas: { modelo3d: true, chegadaAco: true, programaNC: true, dmg: true } },
                    { item: "100", descricao: "N√∫cleo Principal", status: "121", etapas: { modelo3d: true, chegadaAco: true, programaNC: true, dmg: true } },
                    { item: "200", descricao: "Cavidade Superior", status: "200", etapas: { modelo3d: true, chegadaAco: true, programaNC: true, dmg: true } }
                ],
                etapas: [
                    { nome: "Projeto 3D", status: "completed", responsavel: "Equipe CAD", conclusao: "10/03/2023" },
                    { nome: "Usinagem", status: "in-progress", responsavel: "M√°quina CNC-5", previsao: "25/03/2023" },
                    { nome: "Montagem", status: "pending" }
                ]
            };
        }

        // Fun√ß√£o para preencher os dados na p√°gina
        function preencherDados(data) {
            document.querySelector('.molde-header h1').textContent = `Molde ${data.id}`;
            
            // Preenche os campos edit√°veis
            const fields = {
                cliente: data.cliente,
                dataInicio: data.dataInicio,
                previsaoEntrega: data.previsaoEntrega,
                responsavel: data.responsavel
            };
            
            Object.keys(fields).forEach((key, index) => {
                document.querySelectorAll('.editable-field .value')[index].textContent = fields[key];
            });
            
            // Preenche a tabela de pe√ßas (se existirem dados)
            if (data.pecas && data.pecas.length > 0) {
                const pecasList = document.getElementById('pecas-list');
                pecasList.innerHTML = ''; // Limpa a tabela
                
                data.pecas.forEach(peca => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${peca.item}</td>
                        <td>${peca.descricao}</td>
                        <td><input type="checkbox" ${peca.etapas.modelo3d ? 'checked' : ''}></td>
                        <td><input type="checkbox" ${peca.etapas.chegadaAco ? 'checked' : ''}></td>
                        <td><input type="checkbox" ${peca.etapas.programaNC ? 'checked' : ''}></td>
                        <td><input type="checkbox" ${peca.etapas.dmg ? 'checked' : ''}></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td>
                            <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                            <button class="action-btn" title="Remover">üóëÔ∏è</button>
                        </td>
                    `;
                    pecasList.appendChild(row);
                });
            }
        }

        // Configura todos os event listeners
        function setupEventListeners() {
            // Bot√µes de edi√ß√£o
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', handleEditClick);
            });

            // Bot√£o para adicionar pe√ßa
            document.getElementById('add-peca-btn').addEventListener('click', showAddPecaModal);
            
            // Bot√£o para importar do Excel
            document.getElementById('import-excel-btn').addEventListener('click', importFromExcel);
            
            // Bot√£o para salvar
            document.getElementById('save-all-data').addEventListener('click', saveAllData);
            
            // Bot√£o de busca
            document.getElementById('search-peca-btn').addEventListener('click', searchPecas);
        }

        // Manipulador de clique para edi√ß√£o
        function handleEditClick() {
            const field = this.parentElement;
            const valueElement = field.querySelector('.value');
            const currentValue = valueElement.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'edit-input';
            
            valueElement.replaceWith(input);
            input.focus();
            
            this.textContent = 'Salvar';
            this.classList.add('save-mode');
            
            const saveHandler = () => {
                valueElement.textContent = input.value;
                input.replaceWith(valueElement);
                this.textContent = 'Editar';
                this.classList.remove('save-mode');
                this.onclick = handleEditClick;
                console.log('Valor atualizado:', input.value);
            };
            
            this.onclick = saveHandler;
        }

        // Mostrar modal para adicionar pe√ßa
        function showAddPecaModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <h3>Adicionar Nova Pe√ßa</h3>
                    <form id="add-peca-form">
                        <div class="form-group">
                            <label for="peca-item">Item:</label>
                            <input type="text" id="peca-item" required>
                        </div>
                        <div class="form-group">
                            <label for="peca-descricao">Descri√ß√£o:</label>
                            <input type="text" id="peca-descricao" required>
                        </div>
                        <div class="form-group">
                            <label>Etapas conclu√≠das:</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="modelo3d"> Modelo 3D</label>
                                <label><input type="checkbox" name="chegadaAco"> CHEGADA DO A√áO</label>
                                <label><input type="checkbox" name="programaNC"> PROGRAMA NC</label>
                                <label><input type="checkbox" name="dmg"> DMG</label>
                                <label><input type="checkbox" name="600II"> 600 II</label>
                                <label><input type="checkbox" name="800II"> 800 II</label>
                                <label><input type="checkbox" name="600I"> 600 I</label>
                                <label><input type="checkbox" name="800I"> 800 I</label>
                                <label><input type="checkbox" name="ixionII"> IXION II</label>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">Adicionar</button>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Fechar modal
            modal.querySelector('.close-btn').addEventListener('click', function() {
                modal.remove();
            });
            
            // Adicionar nova pe√ßa
            document.getElementById('add-peca-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const item = document.getElementById('peca-item').value;
                const descricao = document.getElementById('peca-descricao').value;
                const formData = new FormData(this);
                
                // Adiciona √† tabela
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${item}</td>
                    <td>${descricao}</td>
                    <td><input type="checkbox" ${formData.get('modelo3d') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('chegadaAco') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('programaNC') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('dmg') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('600II') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('800II') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('600I') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('800I') ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${formData.get('ixionII') ? 'checked' : ''}></td>
                    <td>
                        <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn" title="Remover">üóëÔ∏è</button>
                    </td>
                `;
                
                document.getElementById('pecas-list').appendChild(newRow);
                
                // Adiciona eventos aos bot√µes
                newRow.querySelectorAll('.action-btn')[0].addEventListener('click', function() {
                    editPeca(this.closest('tr'));
                });
                
                newRow.querySelectorAll('.action-btn')[1].addEventListener('click', function() {
                    this.closest('tr').remove();
                });
                
                // Remove o modal
                modal.remove();
            });
            
            modal.style.display = 'block';
        }

        // Importar do Excel
        function importFromExcel() {
            // Esta fun√ß√£o ser√° implementada futuramente
            alert('Funcionalidade de importa√ß√£o do Excel ser√° implementada em breve!');
            console.log('Bot√£o de importa√ß√£o do Excel clicado - funcionalidade pendente');
            
            // Simula√ß√£o de importa√ß√£o
            const pecasSimuladas = [
                { item: "11", descricao: "Pino Guia", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "14", descricao: "Ejetor", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "1451", descricao: "Placa Suporte", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "1570", descricao: "Bloco de Fixa√ß√£o", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "1606", descricao: "Canal Alimentador", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "17", descricao: "Bucha", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "1700", descricao: "Placa de Retorno", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "300", descricao: "N√∫cleo M√≥vel", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "300A", descricao: "Insert A", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "300B", descricao: "Insert B", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "300C", descricao: "Insert C", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "301", descricao: "Placa Ejetora", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "301A", descricao: "Pino Ejetor A", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "301B", descricao: "Pino Ejetor B", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } },
                { item: "301C", descricao: "Pino Ejetor C", etapas: { modelo3d: false, chegadaAco: false, programaNC: false, dmg: false } }
            ];
            
            const pecasList = document.getElementById('pecas-list');
            
            pecasSimuladas.forEach(peca => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${peca.item}</td>
                    <td>${peca.descricao}</td>
                    <td><input type="checkbox" ${peca.etapas.modelo3d ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${peca.etapas.chegadaAco ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${peca.etapas.programaNC ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${peca.etapas.dmg ? 'checked' : ''}></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td>
                        <button class="action-btn" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn" title="Remover">üóëÔ∏è</button>
                    </td>
                `;
                pecasList.appendChild(row);
                
                // Adiciona eventos aos bot√µes
                row.querySelectorAll('.action-btn')[0].addEventListener('click', function() {
                    editPeca(this.closest('tr'));
                });
                
                row.querySelectorAll('.action-btn')[1].addEventListener('click', function() {
                    this.closest('tr').remove();
                });
            });
        }

        // Salvar todos os dados
        function saveAllData() {
            const pecas = [];
            document.querySelectorAll('#pecas-list tr').forEach(row => {
                const cells = row.cells;
                pecas.push({
                    item: cells[0].textContent,
                    descricao: cells[1].textContent,
                    etapas: {
                        modelo3d: cells[2].querySelector('input').checked,
                        chegadaAco: cells[3].querySelector('input').checked,
                        programaNC: cells[4].querySelector('input').checked,
                        dmg: cells[5].querySelector('input').checked,
                        "600II": cells[6].querySelector('input').checked,
                        "800II": cells[7].querySelector('input').checked,
                        "600I": cells[8].querySelector('input').checked,
                        "800I": cells[9].querySelector('input').checked,
                        ixionII: cells[10].querySelector('input').checked
                    }
                });
            });
            
            console.log('Dados salvos:', pecas);
            alert('Dados das pe√ßas salvos com sucesso!');
        }

        // Buscar pe√ßas
        function searchPecas() {
            const searchTerm = document.getElementById('peca-search').value.toLowerCase();
            const rows = document.querySelectorAll('#pecas-list tr');
            
            rows.forEach(row => {
                const pecaItem = row.cells[0].textContent.toLowerCase();
                const pecaDescricao = row.cells[1].textContent.toLowerCase();
                
                if (pecaItem.includes(searchTerm) || pecaDescricao.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Inicia a p√°gina quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>